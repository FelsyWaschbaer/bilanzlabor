% !TeX root = ../main.tex
% Add the above to each chapter to make compiling the PDF easier in some editors.

\chapter{Aufgabenstellung}
Das Ziel dieses interdisziplinären Projektes der Fakultäten Informatik und Bau Geo Umwelt war es, ein interaktives Werkzeug zu erstellen, mit dem die Ergebnisse einer vergleichenden Ökobilanz für verschiedene Sanierungsvarianten eines Gebäudes visualisiert werden können. Das Tool ist als Teil der Lehr- und Lernplattform „Bilanzlabor“ gedacht, die Studierenden über die Themen Nachhaltigkeit und Lebenszyklusanalyse in anschaulicher Form informieren soll.
\section{Lehr- und Lernplattform Bilanzlabor}
Das Bilanzlabor entstand Ende 2014 als Initiative des Zentrums für nachhaltiges Bauen, einem Zusammenschluss verschiedener Lehrstühle der Fakultäten Bau Geo Umwelt, Architektur sowie Elektro- und Informationstechnik. Die Idee war es, eine Plattform zu erstellen, die basierend auf dem Ansatz der forschungsorientierten Lehre Studierenden die Möglichkeit gibt, sich gesamtheitliche Kenntnisse in den Bereichen Nachhaltigkeit und Lebenszyklusanalyse anzueignen und darüber hinaus hilft die wissenschaftliche Zusammenarbeit der beteiligten Fakultäten auf diesen Gebieten zu stärken. Die Inhalte der Lernplattform sollten dabei sowohl von Seiten der Studierenden als auch von Forschern des Bereichs erstellt und bearbeitet werden können. Um dies zu ermöglichen, ist das Bilanzlabor als Internetseite realisiert, die das quelloffene Enterprise Portal „Liferay Portal“ verwendet. Dieses beinhaltet zum einen ein Content-Management-System zur Organisation von Inhalten, die gemeinschaftlich erstellt und bearbeitet werden können, und zum anderen verschiedene Groupware-Komponenten wie Wikis, Foren und Instant Messaging, welche die gemeinsame Zusammenarbeit unterstützen. Zudem gibt es ein System zur rollenbasierten Autorisierung, um Berechtigungen zu erteilen und zu verwalten. Studierende und Wissenschaftler können sich somit über ihre TUM-Kennung authentifizieren und anschließend je nach Berechtigung verschiedene Inhalte einsehen und/oder bearbeiten. Dies ist ohne Programmierkenntnisse der Benutzer möglich.
\section{Vergleichende Ökobilanz verschiedener Sanierungsszenarien}
Das hier beschriebene Projekt sollte einen Beitrag zum Bilanzlabor leisten, indem es dieses um eine interaktive Visualisierung einer vergleichenden Ökobilanz erweitert. 
\subsection{Datengrundlage (Masterarbeit T. Dzharov)}
Die Daten, die der Visualisierung zu Grunde liegen, stammen aus der Masterarbeit von T. Dzharov. Dort wurde untersucht, wie sich verschiedene Sanierungsszenarien auf die Ökobilanz eines Gebäudes auswirken. Bei dem betrachteten Wohngebäude handelte es sich um ein typisches Projekt aus der Nachkriegszeit (1958) mit ungedämmten Außenwänden sowie dezentralen Niedertemperatur-Gasheizkesseln für die Bereitstellung von Trinkwarmwasser und zur Deckung des Heizbedarfs. Die ehemaligen Fenster mit Holzrahmen waren bereits durch solche mit Kunststoffrahmen und 2-Scheiben-Isolierverglasung ersetzt worden. Die untersuchten Sanierungsvarianten unterschieden sich in Energiestandard, Fenstertyp, Außenwanddämmung, Wärmebrücken und Heizungstechnik. Die Optionen für diese Stellschrauben sind in Tabelle~\ref{tab:layers} aufgelistet. 
 
\begin{table}[htpb]
	\caption[Example table]{Stellschrauben der Gebäudesanierung}\label{tab:layers}
	\centering
	\begin{tabular}{l p{10cm}}
		\toprule
		Stellschraube & Optionen \\
		\midrule
		\multirow{3}{*}{Energiestandard} & EnEv 2016\\
		& KfW70 \\
		& KfW55\\ \hline
	    \multirow{3}{*}{Fenster} & Bestand\\
		& Dena 2-Scheiben WSV \\
		& Dena 3-Scheiben WSV\\ \hline
	    \multirow{3}{*}{Wärmedämmung} & EPS-Dämmung\\
		& Holzfaserdämmung \\
		& Hinterlüftete Fassade mit Mineralwolldämmung\\ \hline
	    \multirow{2}{*}{Wärmebrücken} & Wärmebrückenkorrekturfaktor 0,1\\
		& Wärmebrückenkorrekturfaktor 0,05 \\ \hline
	    \multirow{3}{*}{Heizungstechnik (TGA)} & Zentralheizung mit Gasbrennwertkessel und neuen Radiatoren\\
		& Zentralheizung mit Wärmepumpe Luft/Wasser und Flächenheizung \\
		& Zentralheizung mit Pelletkessel und neuen Radiatoren\\ \hline
		\bottomrule
	\end{tabular}
\end{table}

Zusätzlich wurden einige Sanierungsvarianten mit einer Dachaufstockung analysiert, bei der das Dachgeschoss in die thermische Hülle des Gebäudes eingeschlossen wurde. Auch die Nutzung von Sonnenenergie durch die Installation photovoltaischer beziehungsweise solarthermischer Anlagen wurde untersucht.
Für jede der aus der Kombination der verschiedenen Optionen entstehenden Sanierungsvarianten wurde eine Lebenszyklusanalyse über einen Bilanzierungszeitraum von 30 Jahren erstellt. Der betrachtete Zeitraum richtete sich nach der durchschnittlichen technischen Lebensdauer der Mehrzahl, der bei Sanierungsmaßnahmen verwendeten Bauteile. Die Lebenszyklusphasen für das Produktsystem „Gebäude“ wurden für die Auswertung in die drei größeren Blöcke „Herstellung“, „Nutzung“ und „Rückbau“ zusammengefasst. Die im Rahmen der Wirkungsabschätzung betrachteten Wirkungskategorien sind in Tabelle~\ref{tab:wirkungsindikatoren} zu sehen.

\begin{table}[htpb]
	\caption[Example table]{Betrachtete Wirkungskategorien und ihre Indikatoren}\label{tab:wirkungsindikatoren}
	\centering
	\begin{tabular}{p{7cm} l l}
		\toprule
		Wirkungskategorie & Abkürzung & Wirkungsindikator \\
		\midrule
		Nicht erneuerbare Primärenergie (total) & PENRT & Mega-Joule\\ \hline
		Erneuerbare Primärenergie (total) & PERT & Mega-Joule\\ \hline
		Versauerungspotenzial & AP & kg SO\textsubscript{2}-Äquivalent\\ \hline
		Potenzial für den abiotischen Abbau nicht fossiler Ressourcen & ADPE & kg Sb-Äquivalent\\ \hline
		Treibhauspotenzial & GWP & kg CO\textsubscript{2}-Äquivalent\\ \hline
		Eutrophierungspotenzial & EP & kg PO\textsubscript{4}\textsuperscript{2-}-Äquivalent\\ \hline
		Photochemische Ozonbildung & POCP & kg Ethen-Äquivalent\\ \hline
		Ozonabbaupotenzial & ODP & kg CFC11-Äquivalent\\ \hline
		\bottomrule
	\end{tabular}
\end{table}

\subsection{Ziel der Darstellung im Bilanzlabor}
Die Ergebnisse der vergleichenden Ökobilanz sollten auf der Plattform „Bilanzlabor“ so präsentiert werden, dass Studierenden die Umweltauswirkungen verschiedener Sanierungsmaßnahmen deutlich wird. Trotz der Tatsache, dass es sich bei den erhobenen Daten um die eines spezifischen, wenn auch typischen Wohngebäude der Nachkriegszeit handelt,  sollten sich die qualitativen Resultate durchaus generalisieren lassen. Durch eine Beschränkung auf die Wirkungskategorien PENRT, GWP, AP und ODP, werden nur die eindrücklichsten Unterschiede dargestellt.

\chapter{Umsetzung}
Zur Realisierung des Projektes wurde zunächst, ausgehend von einem von T. Dzharov im Rahmen seiner Masterarbeit entwickelten Entwurfes, die Planung einer interaktiven Benutzeroberfläche durchgeführt. Nach der Analyse der vorhandenen Daten folgte die Konzeption einer geeigneten Programmarchitektur um die benötigten Informationen für die Visualisierung zur Verfügung zu stellen und eine Einbindung in die Plattform „Bilanzlabor“ zu ermöglichen.
\section{Datenaufbereitung}
Als Datenbasis stand pro Sanierungsvariante je eine mit dem Tabellenkalkulationsprogramm Excel erstellte Datei zur Verfügung, die die Berechnung der jeweiligen Ökobilanzierung enthielt. Die Dateinamen richteten sich nach den Ausprägungen der Sanierungsoptionen und weitestgehend im in Abbildung~\ref{fig:dateinamenschema} gezeigten Format angegeben. Da die Abkürzungen für die Optionen teilweise nicht einheitlich verwendet worden waren, bestand der erste Schritt der Datenaufbereitung darin, durch die Umbenennung der Dateien eine automatisierte Zuordnung zwischen einer Kombination von Sanierungsoptionen und der die betreffenden Daten enthaltenden Datei zu gewährleisten.
\begin{figure}[htbp]
	\centering
	\includegraphics[height=30mm]{figures/dateiname.png}
	\caption[Dateinamenschema]{Dateinamenschema (nach \autocite{milgram})}
	\label{fig:dateinamenschema}	
\end{figure}   
Des Weiteren existierte eine Excel-Datei mit einer Tabelle in der die Ergebnisse der einzelnen Ökobilanzen zusammengefasst aufgeführt waren. Das Schema mit einigen Bespieldaten ist in Tabelle X zu sehen.
\begin{table}[htpb]
	\caption[Example table]{Schema der Tabelle des Sanierungsvariantenvergleichs }\label{tab:wirkungsindikatoren}
	\centering
	\begin{tabular}{l l l l}
		\toprule
		Variante & WK\textsuperscript{*}\_Herstellung & WK\textsuperscript{*}\_Nutzung & WK\textsuperscript{*}\_Rückbau \\
		\midrule
		EnEV'16\_FB\_EPS\_Pellets\_0.1 & 531429.68 & 1670135.52 & -195844.54 \\ \hline
		... & ... & ... & ... \\ \hline
		\bottomrule
	\end{tabular}
\caption*{\textsuperscript{*} Diese Spalten existieren für jede der Wirkungskategorien PENRT, GWP, ADP und ODP}
\end{table} 

In der Übersichtstabelle waren die Werte aus den Ökobilanzdateien der Sanierungsvarianten durch Hyperlinks referenziert. Da bei dieser Form der Referenzierung der absolute Dateipfad der verlinkten Dateien angegeben werden muss, konnten die Daten nur im Dateisystem des Erstellers der Datei aktualisiert werden. Bei der Analyse der Daten fielen Abweichungen zwischen der Übersicht und den referenzierten Werten auf, was darauf schließen ließ, dass seit der letzten Aktualisierung Änderungen in den Ökobilanzdateien vorgenommen wurden. Aus diesem Grund war eine überarbeitete Form der Datenaggregation unabdingbar. Eine Möglichkeit bestand darin, die Pfade der Hyperlinks manuell neu zu setzen, allerdings wäre die Referenzierung der Daten dadurch wieder an das aktuelle Dateisystem gebunden. Außerdem wäre die Anzahl der zu korrigierenden Verlinkungen bei über hundert Sanierungsvarianten und zwölf Wirkungskategoriespalten deutlich zu hoch gewesen. Theoretisch ist in Excel auch einer Referenzierung über relative Pfade möglich, jedoch werden die Werte nur dann angezeigt, wenn auch die verlinkten Dateien geöffnet sind, was in diesem Fall bei der großen Menge der Dateien nicht praktikabel wäre. Als Lösung des Problems wurde deshalb die Erstellung eines kurzen Software-Programms (Makro) in der Microsoft-Office eigenen Skriptsprache Visual Basic for Applications vorgezogen. Das Programm liest bei seiner Ausführung aus jeder Zeile der Übersichtstabelle den Namen der Sanierungsvariante aus und öffnet anschließend die entsprechende Datei. Dies ist deshalb möglich, weil der Variantenname mit dem Dateinamen übereinstimmt. Der vollständige Dateipfad besteht aus dem Namen der Variante, dem ein variabler Pfad für den Ordner, in dem sich die Ökobilanzdateien befinden vorangestellt wird. Der variable Pfad wird dabei aus einem Feld der Übersichtstabelle gelesen. Durch die Anpassung dieses Stammpfades kann die Aktualisierung der Daten auch in anderen Dateisystemen vorgenommen werden. Nach dem Öffnen einer Datei werden die benötigten Werte aus der Ökobilanz ausgelesen und in die Übersichtstabelle geschrieben. Der Name der Tabelle in dem sich ein bestimmter Wert befindet, sowie die entsprechenden Zellenkoordinaten werden aus der Übersichtstabelle entnommen. Leider war die Formatierung der Ökobilanzdateien nicht vollständig einheitlich, was dem automatisierten Zugriff auf die Werte im Wege stand. In einigen Fällen, in denen nur wenige Dateien Abweichungen zeigten, konnte dies manuell korrigiert werden. Es kam jedoch auch vor, dass die Zeilennummer, in dem sich ein Wert befand, in der Hälfte der Dateien einen Wert annahm und in der anderen Hälfte einen anderen Wert. Als Zellkoordinate konnte deshalb nicht mehr nur ein einzelner Wert angegeben werden. Deshalb wurden in den betreffenden Fällen das in Abbildung~\ref{fig:parameter_format} gezeigte Format für die Eingabeparameter des Programms verwendet.  

\begin{figure}[htbp]
	\centering
	\includegraphics[height=30mm]{figures/parameter_format.png}
	\caption[Dateinamenschema]{Parameterformat}
	\label{fig:parameter_format}	
\end{figure}  

Der erste Parameter ist ein Suchbegriff, um die korrekte Zeile zu finden. Als zweites ist die Spalte angegeben, in der nach dem Begriff gesucht werden soll. Der dritte Parameter gibt die Spalte an, in dem sich der gesuchte Wert befindet. An vierter und fünfter Stelle stehen schließlich die beiden Optionen für die Zeilennummer. Das Programm geht die Optionen durch und prüft ob der Wert in der Suchspalte dem Suchbegriff entspricht. Ist dies der Fall, liest es den Wert in der Wertespalte aus und schreibt ihn in die Übersichtstabelle. Nach dem Füllen der Tabelle durch das Skriptprogramm, wurde diese als CSV-Datei exportiert um die Daten für die Visualisierung zur Verfügung zu stellen.

\section{Architektur der Software}
Das Programm zur Visualisierung der Daten sollte ein Baustein des auf Basis von Liferay Portal erstellten Bilanzlabors werden, ein sogenanntes Portlet. Da Liferay Portal ein sehr umfangreiches und großes Framework darstellt, dauert es bei Betrieb auf einem durchschnittlichen Laptop relativ lange um es zu starten oder geänderte Portlets zu aktualisieren. Dies erschwert den Entwicklungs- und Testprozess und führte zu der Entscheidung das Programm als gewöhnliche Webseite zu implementieren und die Abhängigkeit von Liferay so gering wie möglich zu halten, um eine spätere Integration so einfach wie möglich zu machen. Das Programm besteht deshalb aus einer gewöhnlichen HTML-Datei, die die Struktur der Webseite beschreibt, einer CSS-Datei, mit der das Design festgelegt wird und einer JavaScript-Datei für die funktionellen Aspekte. Die Daten für die Visualisierung werden aus der CSV-Datei geladen und intern in einer Hash-Map mit dem Variantennamen als Schlüssel gespeichert.

\section{Integration in Liferay}

\chapter{Anwenderdokumentation}

